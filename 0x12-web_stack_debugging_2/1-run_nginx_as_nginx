#!/usr/bin/env bash
# This script configures the Nginx container to run as the 'nginx' user and listen on port 8080

set -e

# Update package lists
apt-get update

# Install Nginx
apt-get install -y nginx

# Create 'nginx' user
useradd -r -s /sbin/nologin nginx

# Change ownership of Nginx directories
chown -R nginx:nginx /var/lib/nginx
chown -R nginx:nginx /var/log/nginx
chown -R nginx:nginx /etc/nginx

# Modify Nginx configuration
sed -i 's/user www-data;/user nginx;/' /etc/nginx/nginx.conf
sed -i 's/listen 80;/listen 8080;/' /etc/nginx/sites-available/default.conf

# Start Nginx as 'nginx' user
exec su-exec nginx nginx -g 'daemon off;'